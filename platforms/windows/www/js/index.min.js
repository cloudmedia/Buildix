function processStatus(e){1==e.status?(login=!0,doLogin()):$("#main").load("html/login.html")}function errorConnect(e){var t=serverName;null!=t&&"null"!=t||(t=localStorage.getItem("oldServer")),null!=t&&void 0!==t&&"null"!=t||(t="the server"),loadingOff(),"200"==e.status?notify2(e.responseText,"error",!1):notify2("Failed to connect to "+t+"! ERROR: HTTP-"+e.status,"error",!1)}function appendMainLoad(e,t,n){void 0===t&&(t="yes"),void 0===n&&(n=!1);var o={},a=0,i=!1;e.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,n){"mainload"==t&&(i=!0),o[t]=n,a+=1});return i||(e=a?e+"&mainload="+t:e+"?mainload="+t,n&&(e+="&overload=yes")),e}function mainLoad(e,t,n){sounds.play("bubble"),scrollTop(),loadingOn(),void 0===n&&(n="slideInRight"),void 0===t&&(t="server");var o=server;"local"==t&&(o="html"),e=appendMainLoad(e),console.log("Loading url: "+e),$("#main").load(o+e,function(){$(".box").each(function(){var e=$(this).data("lastEffect"),t=$(this).data("speed");void 0===e&&(e=""),void 0===t&&(t="faster"),"bounceIn"==n&&(t="fast"),"back"==n&&(n="slideInLeft"),$(this).removeClass("animated "+t+" "+e).hide().data("lastEffect",n),$(this).addClass("animated "+t+" "+n).show()})})}function initMain(){loadingOff(),$(".btnLoad").unbind().touch(function(){var e=$(this).data("url"),t=$(this).data("src"),n=$(this).data("effect");mainLoad(e,t,n)}),$(".logout-btn").unbind().touch(function(){askLogout()}),$(".reset-btn").unbind().touch(function(){window.location.replace("index.html")}),$(".help").unbind().touch(function(){var e=$(this).data("topic");loadingOn();var t=server+"/get-help?topic="+e;$.ajax({url:t,method:"get",timeout:5e3,dataType:"json",success:function(e){loadingOff(),1==e.status?notify2(e.help.help_message,e.help.help_class,!1):notify2(e.message)},error:errorConnect})}),$(".username").unbind().touch(function(){mainLoad("/account")}),navLoaded&&initNav()}function loadingOn(){$("#overlay").fadeIn(),$("#site-logo-svg").attr("src","images/bx-loading.svg").removeClass().addClass("animated infinite pulse")}function loadingOff(){$("#overlay").fadeOut(),$("#site-logo-svg").attr("src","images/bx-logo.svg").removeClass().addClass("animated rubberBand")}function askLogout(){var e=new Notify2("Are you sure you want to log out?","info");e.setBindEvent("touchstart"),e.doConfirm(doLogout),e.notify()}function doLogin(){sounds.play("swinga"),loadingOn(),notifyD=new NotifyD(server+"/notifyd"),notifyD.start(),mainLoad("/api/dashboard","server","bounceIn"),setTimeout(function(){reloadNav()},1e3)}function testNotify(e){notify2("It worked!","success")}function testCB(e){notify2(e.target,"info")}function reloadNav(){loadingOn(),$("#nav-vp").load(server+"/api/get-nav",function(){initMain()})}function doLogout(e){notifyD.stop(),scrollTop(),$.getJSON(server+"/logout?action=app",function(e){1==e.status?window.location.replace("index.html"):notify2(e.message)})}function scrollTop(){return $("html, body").animate({scrollTop:0},"fast"),!1}function dump(e,t){var n="";t||(t=0);for(var o="",a=0;a<t+1;a++)o+="    ";if("object"==typeof e)for(var i in e){var r=e[i];"object"==typeof r?(n+=o+"'"+i+"' ...\n",n+=dump(r,t+1)):n+=o+"'"+i+"' => \""+r+'"\n'}else n="===>"+e+"<===("+typeof e+")";return n}function IDGenerator(){this.length=8,this.timestamp=+new Date;var e=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};this.generate=function(){for(var t=this.timestamp.toString(),n=t.split("").reverse(),o="",a=0;a<this.length;++a){var i=e(0,n.length-1);o+=n[i]}return o}}function timeStamp(){var e=new Date,t=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),n=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),o=t+" "+n;return o}var server,serverName,notifyD,debug=!0,initLoaded=!1,login=!1,navLoaded=!1;window.prevFocus=$(),$(document).on("focusin",":input[type=text], :input[type=email], :input[type=tel], :input[type=password], :input[type=number], textarea, select",function(){window.prevFocus=$(this)});var app={initialize:function(){document.addEventListener("deviceready",this.onDeviceReady.bind(this),!1)},onDeviceReady:function(){this.receivedEvent("deviceready")},receivedEvent:function(e){$(document).touch(function(e){hideNotify2($(".notify2:last"))});var t=document.getElementById(e),n=t.querySelector(".listening"),o=t.querySelector(".received");if(n.setAttribute("style","display:none;"),o.setAttribute("style","display:block;"),server=localStorage.getItem("server"),serverName=localStorage.getItem("serverName"),initMain(),!localStorage.getItem("did")){var a=new IDGenerator;localStorage.setItem("did",a.generate()+a.generate())}$("#main-connect-btn").unbind().touch(function(){$("#main-h1").text("Connecting...");var e=$("#main-server").val().toLowerCase(),t=new Valid(e);t.isHostname()?(serverName=e,server="https://"+e,localStorage.setItem("server",server),localStorage.setItem("serverName",serverName),window.location.replace("index.html")):notify2(t.message)}),$("#main-server").focus(function(){$(this).select()}),server?($("#main-h1").text("Connecting...").addClass("animated pulse infinite"),console.log("Received Event: "+e),console.log("Connecting to "+server+"..."),$.ajax({url:server+"/login?action=get-status",method:"get",timeout:5e3,dataType:"json",success:processStatus,error:function(e){$("#main-server").val(serverName),$("#main-h1").text("Connection Failed!"),localStorage.setItem("oldServer",serverName),server=null,serverName=null,localStorage.removeItem("server"),localStorage.removeItem("serverName"),errorConnect(e)}}),console.log("done")):localStorage.getItem("oldServer")&&$("#main-server").val(localStorage.getItem("oldServer"))}};app.initialize(),$.fn.touch=function(e){$(this).on("click",function(t){let n=e.bind(this);n(this,t)})},$.fn.ok=function(){$(this).data("orig-bg",$(this).css("background-color")),$(this).css("background-color","green")},$.fn.bad=function(){$(this).data("orig-bg",$(this).css("background-color")),$(this).css("background-color","#a76363")},$.fn.normal=function(){$(this).css("background-color",$(this).data("orig-bg"))};