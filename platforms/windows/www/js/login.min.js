function resetLogin(){localStorage.removeItem("keep-login"),localStorage.removeItem("otp-key"),localStorage.removeItem("cookie"),$("#login-form").hide(),$("#login-error").addClass("animated bounceIn").show()}function pinEnter(pin){processLogin()}function otpEnter(otp){processLogin()}function processLogin(){if(scrollTop(),$("#login-id").val().length<3)return notify2("Please enter a valid user ID (Email, Username, or User ID#)"),$("#login-id").select(),!1;var val;if(!new Valid($("#login-pass").val()).valPass())return notify2("Please enter a valid password!"),$("#login-pass").bad(),!1;$("#login-pass").ok();var sub=new Submit(server+"/login?action=login");sub.addData("id",$("#login-id").val()),sub.addData("pass",$("#login-pass").val()),sub.addData("pin",$("#login-pin").data("val")),sub.addData("otp",$("#login-otp").data("val")),console.log($("#login-otp").data("val")),sub.addData("did",localStorage.getItem("did")),$("#login-remember").is(":checked")?localStorage.setItem("remember-login","yes"):(localStorage.setItem("remember-login","no"),localStorage.removeItem("saved-login")),$("#keep-login").is(":checked")?(sub.addData("keep-login",!0),localStorage.getItem("cookie")&&sub.addData("cookie",localStorage.getItem("cookie"))):(localStorage.setItem("keep-login","no"),localStorage.removeItem("otp-key")),loadingOn(),$("#login-btn").loadButton("on",{loadingText:"Logging in..."}),sub.submit("json",function(data){switch($("#login-btn").loadButton("off"),loadingOff(),data.status){case 1:"yes"==localStorage.getItem("remember-login")&&localStorage.setItem("saved-login",$("#login-id").val()),void 0!==data.user&&(localStorage.setItem("saved-login",data.user),localStorage.setItem("remember-login","yes")),void 0!==data.key&&localStorage.setItem("otp-key",data.key),void 0!==data.cookie&&(localStorage.setItem("cookie",data.cookie),localStorage.setItem("keep-login","yes")),login=!0,doLogin();break;case 2:notify2(data.message,"warn"),$("#otp-cont").hide(),$("#pin-cont").fadeIn(function(){$("#login-pin").select()});break;case 3:notify2(data.message,"warn"),$("#pin-cont").hide(),$("#otp-cont").fadeIn(function(){$("#login-otp").select()});break;case 4:notify2(data.message),$("#login-error-p").text(data.message),resetLogin();break;default:return notify2(data.message,"error",!1),$("#login-pass").val("").select(),$("#"),!1}})}$(document).ready(function(){var doOTP=!1;if(loadingOff(),initMain(),$("#otp-cont").hide(),$("#server-name").text(serverName),"yes"==localStorage.getItem("remember-login")&&($("#login-remember").attr("checked",!0),$("#login-id").val(localStorage.getItem("saved-login"))),"yes"==localStorage.getItem("keep-login")&&($("#keep-login").attr("checked",!0),$("#login-id").attr("disabled",!0),$("#login-pass").val("NoPassword4u!").attr("disabled",!0),localStorage.getItem("otp-key"))){doOTP=!0;var totp=new TOTP(localStorage.getItem("otp-key"),localStorage.getItem("saved-login"));totp.setCountDownCallback(function(totp){$("#count-down-disp").text(totp.countDown),$("#auto-otp-cont").addClass("animated bounceIn").show()}),totp.setUpdateCallback(function(totp){$("#login-otp").val("******").data("val",totp.otp)}),$("#otp-cont").show()}$(".clear-btn").unbind().touch(function(){server=null,localStorage.setItem("oldServer",localStorage.getItem("serverName")),localStorage.removeItem("server"),localStorage.removeItem("serverName"),localStorage.removeItem("remember-login"),localStorage.removeItem("saved-login"),localStorage.removeItem("keep-login"),localStorage.removeItem("otp-key"),localStorage.removeItem("cookie"),window.location.replace("index.html")}),$("#login-pin").passwordify({maxLength:4,numbersOnly:!0,enterKeyCallback:pinEnter}),$("#login-otp").passwordify({maxLength:6,numbersOnly:!0,enterKeyCallback:otpEnter}),$("#email-otp-btn").touch(function(){$("#email-otp-icon").removeClass("fa-envelope").addClass("fa-cog fa-spin");var me=$(this),origColor=me.css("color");me.css("color","red");var origText=$("#email-otp-text").text();$("#email-otp-text").text("Sending..."),$.getJSON(server+"/login?action=email-otp",function(data){me.css("color",origColor),$("#email-otp-text").text(origText),$("#email-otp-icon").removeClass("fa-cog fa-spin").addClass("fa-envelope"),3==data.status?notify2(data.message,"mail"):notify2(data.message),$("#login-otp").focus()})}),$("#login-btn").touch(function(){processLogin()}),$("#relogin-btn").click(function(){window.location.replace("index.html")}),$("#test-login").click(function(){$("#login-id").val("Joe.Test"),$("#login-pass").val("TestPassword1!")})});