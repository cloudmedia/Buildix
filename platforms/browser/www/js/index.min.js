var server,serverName,login=!1,navLoaded=!1,notifyD;window.prevFocus=$(),$(document).on("focusin",":input[type=text], :input[type=email], :input[type=tel], :input[type=password], :input[type=number], textarea, select",function(){window.prevFocus=$(this)});var app={initialize:function(){document.addEventListener("deviceready",this.onDeviceReady.bind(this),!1)},onDeviceReady:function(){this.receivedEvent("deviceready")},receivedEvent:function(id){$(document).touch(function(e){$(".notify2").each(function(){hideNotify2($(this))})});var parentElement=document.getElementById(id),listeningElement=parentElement.querySelector(".listening"),receivedElement=parentElement.querySelector(".received");if(listeningElement.setAttribute("style","display:none;"),receivedElement.setAttribute("style","display:block;"),server=localStorage.getItem("server"),serverName=localStorage.getItem("serverName"),initMain(),!localStorage.getItem("did")){var gen=new IDGenerator;localStorage.setItem("did",gen.generate()+gen.generate())}$("#main-connect-btn").unbind().touch(function(){$("#main-h1").text("Connecting...");var newServer=$("#main-server").val().toLowerCase(),valid=new Valid(newServer);valid.isHostname()?(serverName=newServer,server="https://"+newServer,localStorage.setItem("server",server),localStorage.setItem("serverName",serverName),window.location.replace("index.html")):notify2(valid.message)}),$("#main-server").focus(function(){$(this).select()}),server?($("#main-h1").text("Connecting...").addClass("animated pulse infinite"),console.log("Received Event: "+id),console.log("Connecting to "+server+"..."),$.ajax({url:server+"/login?action=get-status",method:"get",timeout:5e3,dataType:"json",success:processStatus,error:function(e){$("#main-server").val(serverName),$("#main-h1").text("Connection Failed!"),localStorage.setItem("oldServer",serverName),server=null,serverName=null,localStorage.removeItem("server"),localStorage.removeItem("serverName"),errorConnect(e)}}),console.log("done")):localStorage.getItem("oldServer")&&$("#main-server").val(localStorage.getItem("oldServer"))}};function processStatus(data){1==data.status?(login=!0,doLogin()):$("#main").load("html/login.html")}function errorConnect(e){var errServer=serverName;null!=errServer&&"null"!=errServer||(errServer=localStorage.getItem("oldServer")),null!=errServer&&void 0!==errServer&&"null"!=errServer||(errServer="the server"),loadingOff(),"200"==e.status?notify2(e.responseText,"error",!1):notify2("Failed to connect to "+errServer+"! ERROR: HTTP-"+e.status,"error",!1)}function mainLoad(url,src,effect){sounds.play("bubble"),scrollTop(),loadingOn(),void 0===effect&&(effect="slideInRight"),void 0===src&&(src="server");var prefix=server;"local"==src&&(prefix="html"),$("#main").load(prefix+url,function(){$(".box").each(function(){var last=$(this).data("lastEffect"),speed=$(this).data("speed");void 0===last&&(last=""),void 0===speed&&(speed="faster"),"bounceIn"==effect&&(speed="fast"),"back"==effect&&(effect="slideInLeft"),$(this).removeClass("animated "+speed+" "+last).hide().data("lastEffect",effect),$(this).addClass("animated "+speed+" "+effect).show()})})}function initMain(){loadingOff(),$(".btnLoad").unbind().touch(function(){var url,src,effect;mainLoad($(this).data("url"),$(this).data("src"),$(this).data("effect"))}),$(".logout-btn").unbind().touch(function(){askLogout()}),$(".reset-btn").unbind().touch(function(){window.location.replace("index.html")}),$(".help").unbind().touch(function(){var topic=$(this).data("topic");loadingOn();var help_url=server+"/get-help?topic="+topic;$.ajax({url:help_url,method:"get",timeout:5e3,dataType:"json",success:function(data){loadingOff(),1==data.status?notify2(data.help.help_message,data.help.help_class,!1):notify2(data.message)},error:errorConnect})}),$(".username").unbind().touch(function(){mainLoad("/account")}),navLoaded&&initNav()}function loadingOn(){$("#site-logo-svg").attr("src","images/bx-loading.svg").removeClass().addClass("animated infinite pulse")}function loadingOff(){$("#site-logo-svg").attr("src","images/bx-logo.svg").removeClass().addClass("animated rubberBand")}function askLogout(){var n=new Notify2("Are you sure you want to log out?","info");n.setBindEvent("touchstart"),n.doConfirm(doLogout),n.notify()}function doLogin(){sounds.play("swinga"),loadingOn(),(notifyD=new NotifyD(server+"/notifyd")).start(),mainLoad("/api/dashboard","server","bounceIn"),setTimeout(function(){reloadNav()},1e3)}function testNotify(n){notify2("It worked!","success")}function testCB(n){notify2(n.target,"info")}function reloadNav(){loadingOn(),$("#nav-vp").load(server+"/api/get-nav",function(){initMain()})}function doLogout(n){notifyD.stop(),scrollTop(),$.getJSON(server+"/logout?action=app",function(data){1==data.status?window.location.replace("index.html"):notify2(data.message)})}function scrollTop(){return $("html, body").animate({scrollTop:0},"fast"),!1}function dump(arr,level){var dumped_text="";level||(level=0);for(var level_padding="",j=0;j<level+1;j++)level_padding+="    ";if("object"==typeof arr)for(var item in arr){var value=arr[item];"object"==typeof value?(dumped_text+=level_padding+"'"+item+"' ...\n",dumped_text+=dump(value,level+1)):dumped_text+=level_padding+"'"+item+"' => \""+value+'"\n'}else dumped_text="===>"+arr+"<===("+typeof arr+")";return dumped_text}function IDGenerator(){this.length=8,this.timestamp=+new Date;var _getRandomInt=function(min,max){return Math.floor(Math.random()*(max-min+1))+min};this.generate=function(){for(var ts,parts=this.timestamp.toString().split("").reverse(),id="",i=0;i<this.length;++i){var index;id+=parts[_getRandomInt(0,parts.length-1)]}return id}}function timeStamp(){var today=new Date,date,time,dateTime;return today.getFullYear()+"-"+(today.getMonth()+1)+"-"+today.getDate()+" "+(today.getHours()+":"+today.getMinutes()+":"+today.getSeconds())}app.initialize(),$.fn.touch=function(callback){var touch=!1;$(this).on("click",function(e){if(touch)touch=!0;else{let callbackReal;callback.bind(this)(this,e)}touch=!1}),$(this).on("touchstart",function(e){if(void 0!==e.touches){let callbackReal;e.preventDefault(),touch=!0,callback.bind(this)(this,e)}})},$.fn.ok=function(){$(this).data("orig-bg",$(this).css("background-color")),$(this).css("background-color","green")},$.fn.bad=function(){$(this).data("orig-bg",$(this).css("background-color")),$(this).css("background-color","#a76363")},$.fn.normal=function(){$(this).css("background-color",$(this).data("orig-bg"))};